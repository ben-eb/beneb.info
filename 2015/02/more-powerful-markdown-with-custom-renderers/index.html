<html><head><title>More powerful Markdown with custom renderers | Ben Briggs - Front end developer</title><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="stylesheet" href="/css/main.css"></head><body><nav class="navbar navbar-default" role="navigation"><div class="container"><div class="navbar-header"><a class="navbar-brand" href="/">Ben Briggs</a></div></div></nav><div class="container"><div class="row"><h1 class="col-lg-12"><a href="/2015/02/more-powerful-markdown-with-custom-renderers" title="Permanent link to 'More powerful Markdown with custom renderers'">More powerful Markdown with custom&nbsp;renderers</a></h1></div><div class="row"><article class="col-lg-9"><p>Markdown is great if you just want to put your thoughts down somewhere; its plain text, no-nonsense approach means that it is much easier to focus on actually <em>writing</em> an article, rather than messing around with different HTML elements &amp; classes. However, what if we're using a framework such as Bootstrap, which has great blockquote styling, <em>but only if we structure our HTML a certain&nbsp;way</em>?</p><p>To get the nice dash before our citation, Bootstrap requires that we place it in a <code>&lt;footer&gt;</code> tag, which is fine, but Markdown doesn't offer this capability for us. It does allow us to write HTML inline instead, but that isn't very portable; what if we migrate to another framework that doesn't use this HTML? Well, we end up having this HTML forever in our Markdown&nbsp;files.</p><p>That doesn't sound very appealing. So, what we'll do instead is use <a href="https://github.com/cheeriojs/cheerio">cheerio</a> and write a custom renderer for <a href="https://github.com/chjj/marked">marked</a> to automate the process for us; all we have to do from now on is write blockquotes in Markdown format, and it will be converted into our custom HTML&nbsp;automatically.</p><blockquote><p>I couldn't tell you in any detail how my computer works. I use it with a layer of&nbsp;automation.</p><footer><a href="http://www.wired.co.uk/news/archive/2012-06/28/conrad-wolfram-computation">Conrad Wolfram</a></footer></blockquote><p>In Markdown, this quote would look like the&nbsp;following:</p><pre><code class="lang-markdown"><span class="hljs-blockquote">&gt; I couldn't tell you in any detail how my computer works. I use it with a layer</span>
<span class="hljs-blockquote">&gt; of automation.</span>
<span class="hljs-blockquote">&gt;
&gt; --[Conrad Wolfram][1]</span>
</code></pre><p>We want to generate the following&nbsp;output:</p><pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-title">blockquote</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span>I couldn't tell you in any detail how my computer works. I use it with a
    layer of automation.<span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">footer</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"http://www.wired.co.uk/news/archive/2012-06/28/conrad-wolfram-computation"</span>&gt;</span>Conrad Wolfram<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">footer</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">blockquote</span>&gt;</span>
</code></pre><p>In my case, I'm using <a href="http://www.metalsmith.io/">metalsmith</a> to transform the Markdown into HTML, but the renderer logic will be the same as for any other set up. Here's the code for&nbsp;that:</p><pre><code class="lang-js"><span class="hljs-keyword">var</span> cheerio  = <span class="hljs-built_in">require</span>(<span class="hljs-string">'cheerio'</span>);
<span class="hljs-keyword">var</span> renderer = <span class="hljs-keyword">new</span> (<span class="hljs-built_in">require</span>(<span class="hljs-string">'marked'</span>)).Renderer();

renderer.blockquote = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(text)</span> </span>{
    <span class="hljs-keyword">var</span> $ = cheerio.load(<span class="hljs-string">''</span> + text);
    $(<span class="hljs-string">'p'</span>).each(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">if</span> ($(<span class="hljs-keyword">this</span>).text().indexOf(<span class="hljs-string">'--'</span>) === <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">var</span> html = $(<span class="hljs-keyword">this</span>).html().replace(<span class="hljs-string">'--'</span>, <span class="hljs-string">''</span>);
            $(<span class="hljs-keyword">this</span>).replaceWith($(<span class="hljs-string">'&lt;footer&gt;'</span> + html + <span class="hljs-string">'&lt;/footer&gt;'</span>));
        }
    });
    <span class="hljs-keyword">return</span> <span class="hljs-string">'&lt;blockquote&gt;'</span> + $.html() + <span class="hljs-string">'&lt;/blockquote&gt;'</span>;
};
</code></pre><p>Here, we load the HTML into the cheerio parser, and then check each paragraph inside which starts with <code>--</code>. We then wrap that paragraph with the <code>&lt;footer&gt;</code> tag, and strip away the double dashes (which are replaced by a dash in the&nbsp;CSS).</p><p>All we have to do now is pass that renderer to <a href="https://github.com/segmentio/metalsmith-markdown">metalsmith-markdown</a>:</p><pre><code class="lang-js"><span class="hljs-keyword">var</span> Metalsmith = <span class="hljs-built_in">require</span>(<span class="hljs-string">'metalsmith'</span>);
<span class="hljs-keyword">var</span> markdown   = <span class="hljs-built_in">require</span>(<span class="hljs-string">'metalsmith-markdown'</span>);

Metalsmith(__dirname)
    <span class="hljs-comment">// ...</span>
    .use(markdown({ renderer: renderer }))
    <span class="hljs-comment">// ...</span>
    .build(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(err)</span> </span>{
        <span class="hljs-keyword">if</span> (err) {
            <span class="hljs-keyword">throw</span> err;
        }
    });
</code></pre><p>We now have automatic <code>&lt;footer&gt;</code> generation for blockquotes, site-wide; and if the CSS framework is changed to one that does not require this tag, it is as easy to&nbsp;remove.</p><p>Check out the full <a href="https://github.com/ben-eb/beneb.info/blob/master/gulpfile.js">build process for my blog</a>, which uses this&nbsp;technique.</p></article><aside class="col-lg-3"><div class="row"><div class="col-sm-3 col-lg-12"><h4 class="meta-description">Published</h4><p class="meta-description--contents">Saturday, February 21st 2015, at&nbsp;17:17</p></div><div class="col-sm-3 col-lg-12"><h4 class="meta-description">Estimated reading&nbsp;time</h4><p class="meta-description--contents">2 min (474&nbsp;words)</p></div><div class="col-sm-3 col-lg-12"><h4 class="meta-description">Topics</h4><p><a href="/topics/productivity" class="label label-default" title="Browse entries tagged with 'productivity'">productivity</a> <a href="/topics/typography" class="label label-default" title="Browse entries tagged with&nbsp;'typography'">typography</a></p></div></div></aside></div><div id="disqus_thread"></div><script type="text/javascript">/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'benebinfo'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><div class="container"><footer><small>Designed &amp; built by Ben Briggs &copy; 2015. Find my code on <a href="https://github.com/ben-eb">GitHub</a> and more opinions on <a href="https://twitter.com/ben_eb">Twitter</a>.</small></footer></div></body></html>